# Hive


## Task 1
Создайте внешние (EXTERNAL) таблицы по исходным данным. В результате будет 4 таблицы: логи пользователей, данные ip адресов, данные пользователей и подсети. Из таблицы логов перенесите данные в другую таблицу, партицированную по датам – одна партиция на каждый день. На партиционированных таблицах и нужно будет выполнять запросы в следующих задачах.
Требуется, чтобы сериализация и десериализация данных осуществлялась с использованием регулярных выражений (см. org.apache.hadoop.hive.contrib.serde2.RegexSerDe, org.apache.hadoop.hive.serde2.RegexSerDe).
Проверить правильность создания таблиц с помощью простейших запросов (SELECT * FROM <table> LIMIT 10). Эти Select запросы нужно также добавлять в скрипт задачи.

Пример результата:

    33.49.147.163    http://lenta.ru/4303000    1189    451    Chrome/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)n    20140101
    75.208.40.166    http://newsru.com/3330815    60    306    Safari/5.0 (Windows; U; MSIE 9.0; Windows NT 8.1; Trident/5.0; .NET4.0E; en-AU)n    20140101



## Task 2
Напишите запрос, выбирающий количество посещений для каждого дня. Полученные результаты отсортируйте по убыванию количества.
Пример результата:

    20140308    96
    20140409    96
    20140318    96

## Task 3
Напишите запрос, выбирающий количество посещений от мужчин и от женщин по регионам.
Пример результата:

    Tver    66968157    29097223
    Voronezh    60445347    26333509

## Task 4
Создать UDF «перевертыш». Функция принимает строку и возвращает данную строку записанную в обратном порядке. Подключите данную функцию к hive и выполните выборку «перевертышей» для ip адресов. Вывести TOP-10 записей.
Пример результата:

    661.04.802.57
    791.39.552.861
    661.04.802.57

## Task 5
Представьте ситуацию, что все новостные сайты переехали в домен .com. Вас попросили обновить базу логов, чтоб логи пользователей указывали не на старые домены, а на новые. Например, новостная ссылка http://news.rambler.ru/8744806 теперь должна выглядеть в ваших запросах как http://news.rambler.com/8744806. Используйте стриминг в hive-sql запросе. (Рекомендуется обратить внимание на команды awk и sed). Выведите TOP-10 записей логов без сортировки.
Пример результата:

    49.203.96.67    20140102    http://lenta.com/2296722    716    499    Safari/5.0
    33.49.147.163    20140102    http://news.yandex.com/5605690    850    300    Safari/5.0


## Task 6

В терминологии сетей TCP/IP маской сети называется двоичное число, определяющее, какая часть IP-адреса узла сети относится к адресу сети, а какая – к адресу самого узла в этой сети. В маске сначала (в старших разрядах) стоят единицы, а затем с некоторого разряда – нули. Адрес сети получается в результате применения поразрядной конъюнкции к заданному IP-адресу узла и маске.
Сеть располагает некоторым диапазонов IP-адресов. 1-й адрес в диапазоне – непосредственно адрес сети, последний – широковещательный. Остальные адреса являются адресами хостов.

Требуется написать UDTF. На вход ей подаются пары `адрес сети и адрес маски`

    158.58.247.125
    ...
    188.70.82.81
    188.70.82.82

